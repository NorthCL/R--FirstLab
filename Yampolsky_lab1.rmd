---
title: "Лабораторная работа № 1"
author: "Ямпольский Антон"
date: "21 12 2020"
output: word_document
---

```{r setup, include=FALSE}

# Загружаем библиотеки
library('knitr')
library('Hmisc')          # для расчёта корреляционной матрицы
library('corrplot')       # визуализация корреляционных матриц: corrplot()
library('nortest')        # для теста Андерсона-Дарлинга ad.test()

knitr::opts_chunk$set(echo = TRUE)
```

## Раздел I.
В этом разделе необходимо собрать данные по социально-экономическим показателям в регионах РФ и изучить их взаимосвязи.

**Необходимо построить:**
  
* гистограммы на одном полотне, отразив теоретические плотности распределения;

* таблицу со статистикой теста Андерсона-Дарлинга на нормальность;

* точечные графики взаимного разброса с полупрозрачными маркерами;

* графическое представление корреляционной матрицы.

### Обозначения количественных показателей:

* *IPI.2013* – Индексы промышленного производства.   
* *PIM.2013* – Индесы цен производителей промышленных товаров по видам экономической деятельности: обрабатывающие производства.   
* *DDFA.2013* – Степень износа основных фондов.   
* *FCI.2012* – Инвестиции в основвной капитал на душу населения.   
* *DLR.2013* – Задолжность по кредитам в рублях, предоставленым кредитными организациями юридическим лицам. 
## Импорт данных:

```{r import, echo = FALSE}
#импорт данных из .csv
file.path <- 'Yampolsky.csv'
DF <- read.csv2(file.path, stringsAsFactors = F)
```


#Файл с данными содержит `r nrow(DF)` строк и `r ncol(DF)` столбцов.   

```{r, echo = FALSE}
# делаем из столбца "FO" фактор
DF$FO <- factor(DF$FO)
    
# оставляем только регионы и выбрасываем столбец меток, 
#  чтобы удобнее было считать
reg.df <- DF[DF$Regcode < 1000, c(-1, -2)]
# выбрасываем пропущенные
reg.df <- na.omit(reg.df)
```

## Описательная статистика  


```{r, echo = FALSE}
# ручной расчёт
#  средние арифметические
mns <- round(apply(reg.df[, -1], 2, mean), 1)
#  стандартные отклонения
sds <- round(apply(reg.df[, -1], 2, sd), 1)
#  коэффициенты вариации
coef.vars <- round(sds / mns * 100, 1)
# делаем свою таблицу только с нужными статистиками 
#  по количественным показателям: среднее, СКО, коэффициент вариации
smm <- rbind(mns, sds, coef.vars)
# названия статистик -- заголовки строк
row.names(smm) <- c('Среднее', 'Стандартное отклонение', 'Коэффициент вариации, %')
knitr::kable(smm)
```
**Вывод:** показатели  *FCI.2012*, *DLR.2013* неоднородны, т.к. коэффициент вариации > 33%

## Анализ распределения данных

# Коробчатые диаграммы


```{r, echo = FALSE}
# Анализ распределения данных
# Коробчатые диаграммы
# Строим диаграммы на одном полотне
par(mfrow = c(1,5)) #полотно на 5 частей
par(oma = c(0, 0, 2, 0)) #внешние поля общего полотна
par(mar = c(4, 4, 1.5, 0.5)) # внутренние поля каждого графика
#цикл по столбцам    
  for (i in 2:6) {
  x <- reg.df[,i]
  boxplot(x,
          freq = F,
          col = "khaki",
          main = colnames(reg.df[i]))
}
# общий заголовок для всех графиков
title(main = 'Коробчатые диаграммы для всех показателей', 
     outer = TRUE, cex = 1.5)
#Настройки полотна обратно
par(mfrow = c(1, 1))
```

**Вывод:** Можно заметить, что каждый показатель имеет выбросы (свои аномальные точки)

# Тесты на нормальность
# Тест Андерсона-Дарлинга
```{r, echo = FALSE}
# применяем ко всем столбцам и вытаскиваем только тестовую статистику
W <- sapply(reg.df[, 2:6], function(x) {
  round(ad.test(x)$statistic, 4)
})
p <- sapply(reg.df[, 2:6], function(x) {
  round(ad.test(x)$p.value,4)
})
table <- rbind(W, p)
rownames(table) <- c("Статистика теста","Критическое значение")
kable(table)
```

**Вывод:**Проверяя гипотезу нормального распределения для переменных на уровне значимости 0.05, мы отвергаем все факторы,так как их p-значения < 0.05.

# Анализ линейных взаимосвязей
# Точечные графики разброса

```{r, echo = FALSE}
pairs(reg.df[, -1],
      pch = 21,
      col = rgb(0, 0, 1, alpha = 0,4),
      bg = rgb(0.8, 0.7, 0.25, alpha = 0.4),
      cex = 1.1)
```


**Вывод:** по первой строке графиков попытаемся определить наличие связи между *IPI.2013* и остальными показателями. У *IPI.2013* и *PIM.2013* и *DDFA.2013* положительная связь. А с остальными у *IPI.2013* связи нет.

# Корреляционная матрица
# коэффициенты Пирсона с Р-значениями

```{r, echo = FALSE}
r.corr <- rcorr(as.matrix(reg.df[, -1]))
#Визуализация корреляционной матрицы
matrix.cor <- r.corr$r
#сохраняем p-значения
matrix.p <- r.corr$P
# изображаем матрицу графически
corrplot(matrix.cor,
         method = "circle",
         diag = F)
title(ylab = 'Корреляция показателей')
```
**Вывод:** Взаимосвязь *IPI.2013* слабо значима с показателем *PIM.2013*, а с *DDFA.2013* наблюдается обратная связь.


## Раздел II
В этом разделе необходимо прологарифмировать данные из первого раздела и провести с новыми данными те же махинации.
## Описательная статистика логарифмированных данных:

```{r, echo = FALSE}
#фрейм с логарифмированными данными
DF1 <- reg.df
DF1$IPI.2013 <- log(reg.df$IPI.2013)
DF1$PIM.2013 <- log(reg.df$PIM.2013)
DF1$DDFA.2013 <- log(reg.df$DDFA.2013)
DF1$FCI.2012 <- log(reg.df$FCI.2012)
DF1$DLR.2013 <- log(reg.df$DLR.2013)
# ручной расчёт
#  средние арифметические
mns1 <- round(apply(DF1[, -1], 2, mean), 3)
#  стандартные отклонения
sds1 <- round(apply(DF1[, -1], 2, sd), 3)
#  коэффициенты вариации
coef.vars1 <- round(sds1 / mns1 * 100, 3)
# делаем свою таблицу только с нужными статистиками 
#  по количественным показателям: среднее, СКО, коэффициент вариации
smm1 <- rbind(mns1, sds1, coef.vars1)
# названия статистик -- заголовки строк
row.names(smm1) <- c('Среднее', 'Стандартное отклонение', 'Коэффициент вариации, %')
kable(smm1)
```

**Вывод:** показатели считаются не полностью однородными, т.к. ни один коэффициент вариации не превышает 33%.

## Анализ распределения данных

#Построим коробчатые диаграммы.

```{r, echo = FALSE}
par(mfrow = c(1,5)) #полотно на 5 частей
par(oma = c(0, 0, 2, 0))
par(mar = c(4, 4, 1.5, 0.5))
#цикл по столбцам
for (i in 2:6) {
  x <- DF1[,i]
  boxplot(x,
          col = "khaki",
          freq = F,
          main = colnames(reg.df[i]))
}
# общий заголовок для всех графиков
title(main = "Коробчатые диаграммы для всех показателей", 
      outer = TRUE, cex = 1)
#Настройки полотна обратно
par(mfrow = c(1, 1))
```


**Вывод:** Каждый признак имеет выбросы.

## Тест Андерсона-Дарлинга на нормальность распределения

```{r, echo = FALSE}
# применяем ко всем столбцам и вытаскиваем только тестовую статистику
# для изначальных значений
W <- sapply(DF1[, 2:6], function(x) {
  round(ad.test(x)$statistic, 4)
})
p <- sapply(DF1[, 2:6], function(x) {
  round(ad.test(x)$p.value, 4)
})
table1 <- data.frame(p, W)
kable(table1)
```

**Вывод:** Проверяя гипотезу нормального распределения для переменных на уровне значимости 0.05, мы отвергаем все, кроме  *"DLR.2013"*, так как остальные p-значения < 0.05 .

## Графики разброса

```{r, echo = FALSE}
# графики взаимного разброса по логарифмированным данным
pairs(DF1[, -1],     # фрейм без первого столбца-фактора
      pch = 5,         # тип символов для точек
      col = rgb(0.8, 0.7, 0.25, alpha = 0.4),   # цвет заливки точек
      bg = rgb(0.8, 0.7, 0.25, alpha = 0.4),    # цвет границы точек
      cex = 1.1)                 # масштаб символов для точек
```

**Вывод:** по первой строке графиков попытаемся определить наличие связи между *IPI.2013* и остальными показателями. У *IPI.2013* и *FCI.2012* и *DLR.2013* положительная связь. А с остальными у *IPI.2013* связи нет.
## Корреляционная матрица

```{r, echo = FALSE}
# коэффициенты Пирсона с P-значениями
r.corr <- rcorr(as.matrix(DF1[, -1]))
# Визуализация корреляционной матрицы  =========================================
# сохраняем корреляционную матрицу
matrix.cor <- r.corr$r
# сохраняем p-значения
matrix.p <- r.corr$P
# изображаем матрицу графически
corrplot(matrix.cor,          # сама корреляционная матрица
         order = 'original',  # порядок отображения показателей 
         # в матрице
         diag = F,            # не отображать значения на главной 
         # диагонали
         p.mat = matrix.p,    # p-значения
         #insig = 'blank',     # метод отображения незначимых
         sig.level = 0.05)    # уровень значимости
title(ylab = 'Корреляция логарифмированных показателей')
```

**Вывод:** Взаимосвязь *DDFA.2013* имеет обратную свзь с показателем *PIM.2013*, а *FCI.2012* слабо значима с показателем *DDFA.2013*.

```{r, echo = FALSE}
# 5. Сохранение рабочего пространства  ------------------------------------------
# сохраняем нужные объекты в файл
save(list = c('DF', 'reg.df', 'DF1'), file = 'test_lab1_Yampolsky.RData')
save.image('test_lab1_Yampolsky.RData')
rm()
```





